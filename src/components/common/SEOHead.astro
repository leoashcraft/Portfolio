---
import { profile } from '../../data/profile';
import { seo, schema } from '../../data/seo';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article' | 'profile';
  publishedTime?: Date;
  modifiedTime?: Date;
  tags?: string[];
  noindex?: boolean;
}

const {
  title,
  description = profile.description,
  image = '/img/pic.webp',
  type = 'website',
  publishedTime,
  modifiedTime,
  tags = [],
  noindex = false,
} = Astro.props;

const pageTitle = title ? `Leo Ashcraft | ${title}` : seo.siteTitle;
const metaDescription = description || seo.siteDescription;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);

// JSON-LD Structured Data - Enhanced Person Schema
const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  '@id': schema.personId,
  name: profile.name,
  url: 'https://leoashcraft.com',
  image: new URL(profile.photoUrl, Astro.site).href,
  description: seo.siteDescription,
  jobTitle: schema.jobTitle,
  worksFor: {
    '@type': schema.worksFor.type,
    name: schema.worksFor.name,
  },
  alumniOf: {
    '@type': schema.alumniOf.type,
    name: schema.alumniOf.name,
  },
  knowsAbout: schema.knowsAbout,
  sameAs: schema.sameAs,
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: seo.siteTitle,
  url: Astro.site?.href,
  author: personSchema,
};

const articleSchema =
  type === 'article' && publishedTime
    ? {
        '@context': 'https://schema.org',
        '@type': 'BlogPosting',
        headline: title,
        description,
        image: imageURL.href,
        author: personSchema,
        datePublished: publishedTime.toISOString(),
        dateModified: (modifiedTime || publishedTime).toISOString(),
        keywords: tags.join(', '),
      }
    : null;

const schemas = [websiteSchema, personSchema, articleSchema].filter(Boolean);
---

<!-- Preconnect to external resources (highest priority) -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<title>{pageTitle}</title>
<meta name="title" content={pageTitle} />
<meta name="description" content={metaDescription} />
<meta name="author" content={profile.name} />
<meta
  name="keywords"
  content={seo.keywords}
/>
<link rel="canonical" href={canonicalURL} />

{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta name="theme-color" content="#0a0a0f" />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={metaDescription} />
<meta property="og:image" content={imageURL} />
<meta property="og:site_name" content={seo.siteTitle} />
<meta property="og:locale" content="en_US" />

{
  type === 'article' && publishedTime && (
    <>
      <meta property="article:published_time" content={publishedTime.toISOString()} />
      {modifiedTime && (
        <meta property="article:modified_time" content={modifiedTime.toISOString()} />
      )}
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalURL} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={metaDescription} />
<meta name="twitter:image" content={imageURL} />

<!-- JSON-LD Structured Data -->
{
  schemas.map((schema) => (
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
  ))
}

<!-- Critical inline styles for fastest FCP -->
<style>
  body{background:#0a0a0f;color:#e5e5e5;font-family:Inter,ui-sans-serif,system-ui,sans-serif}
  .gradient-text-animated{background:linear-gradient(135deg,#facc15,#f97316,#facc15);-webkit-background-clip:text;background-clip:text;color:transparent}
</style>

<!-- Google Fonts (non-render-blocking, display=optional for no layout shift) -->
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400&display=optional"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400&display=optional"
  rel="stylesheet"
  media="print"
  onload="this.media='all'"
/>
<noscript>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400&display=optional"
    rel="stylesheet"
  />
</noscript>
