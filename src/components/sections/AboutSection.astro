---
import { profile } from '../../data/profile';
import { skills, services } from '../../data/skills';
import { site } from '../../data/site';
---

<section id="about" class="section section-arcade px-4 overflow-hidden" aria-labelledby="about-heading">
  <!-- Neon Top Border -->
  <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-neon-cyan/50 to-transparent"></div>

  <!-- Floating Arcade Decorations -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <!-- Glowing orbs -->
    <div class="absolute top-20 left-10 w-64 h-64 rounded-full bg-neon-pink/10 blur-3xl"></div>
    <div class="absolute bottom-40 right-20 w-80 h-80 rounded-full bg-neon-purple/10 blur-3xl"></div>
    <div class="absolute top-1/2 left-1/3 w-48 h-48 rounded-full bg-neon-yellow/5 blur-2xl"></div>

    <!-- Geometric shapes -->
    <div class="absolute top-32 right-[15%] w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-b-[26px] border-b-neon-pink/40 drift-1"></div>
    <div class="absolute top-[60%] left-[8%] w-6 h-6 border-2 border-neon-yellow/50 rotate-45 drift-2"></div>
    <div class="absolute bottom-32 right-[25%] w-8 h-8 border-2 border-neon-green/40 rounded-full drift-slow spin-slow"></div>
    <div class="absolute top-[40%] right-[5%] w-5 h-5 bg-neon-orange/30 rotate-45 drift-3"></div>
    <div class="absolute bottom-[20%] left-[12%] w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-b-[20px] border-b-neon-purple/30 drift-diagonal"></div>

    <!-- Zigzag line -->
    <svg class="absolute top-[30%] left-[3%] w-16 h-8 text-neon-orange/40 drift-slow" viewBox="0 0 64 32">
      <path d="M0 16 L16 0 L32 16 L48 0 L64 16" fill="none" stroke="currentColor" stroke-width="2"/>
    </svg>

    <!-- Circle ring -->
    <div class="absolute bottom-[40%] right-[8%] w-12 h-12 border-2 border-neon-pink/30 rounded-full drift-2"></div>
  </div>

  <div class="max-w-6xl mx-auto relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <h2 id="about-heading" class="section-title">
        {site.sections.about.title} <span class="gradient-text">{site.sections.about.titleHighlight}</span>
      </h2>
      <p class="section-subtitle mx-auto">
        {site.sections.about.subtitle}
      </p>
    </div>

    <!-- Content Grid -->
    <div class="grid lg:grid-cols-2 gap-12 items-center mb-20">
      <!-- Photo -->
      <div class="relative max-w-[70%] mx-auto lg:ml-12 lg:order-2">
        <div
          class="relative z-10 rounded-2xl overflow-hidden border-2 border-neon-pink/30"
        >
          <img
            src={profile.photoUrl}
            alt={`${profile.name} - ${profile.title}`}
            class="w-full h-auto"
            loading="lazy"
          />
          <!-- Gradient overlay -->
          <div
            class="absolute inset-0 bg-gradient-to-t from-night-900/80 via-transparent to-transparent"
          >
          </div>
        </div>
        <!-- Decorative elements -->
        <div
          class="absolute -top-3 -right-3 w-[calc(100%+6px)] h-[calc(100%+6px)] border-2 border-neon-purple/40 rounded-2xl -z-10"
          aria-hidden="true"
        >
        </div>
        <div
          class="absolute -bottom-3 -left-3 w-24 h-24 bg-neon-pink/15 rounded-full blur-2xl"
          aria-hidden="true"
        >
        </div>
        <div
          class="absolute top-1/3 -right-2 w-16 h-16 bg-neon-yellow/10 rounded-full blur-xl"
          aria-hidden="true"
        >
        </div>
      </div>

      <!-- Bio -->
      <div class="mx-auto lg:mx-0 lg:mr-12">
        <h3 id="about-tagline" class="text-2xl font-bold text-white mb-4 relative" data-text={profile.tagline}>
          <span class="tagline-placeholder invisible" aria-hidden="true">{profile.tagline}</span>
          <span class="absolute left-0 top-0"><span class="tagline-text"></span><span class="tagline-cursor hidden">|</span></span>
        </h3>
        <div id="about-bio" class="prose prose-lg mb-8 text-gray-300 leading-relaxed">
          {profile.bio.split('\n\n').map((paragraph, i) => (
            <p class="bio-line mb-4">{paragraph}</p>
          ))}
        </div>

        <!-- Quick Info -->
        <div class="grid grid-cols-2 gap-4 mb-8">
          <div class="glass p-4">
            <span class="text-gray-400 text-sm">Location</span>
            <p class="text-white font-medium">{profile.location}</p>
          </div>
          <div class="glass p-4">
            <span class="text-gray-400 text-sm">Availability</span>
            <p class="text-neon-green font-medium">{site.sections.about.availabilityText}</p>
          </div>
        </div>

        <!-- CTA -->
        <div class="flex flex-wrap gap-4">
          <a href={profile.resumeUrl} download class="btn btn-primary">
            Download Resume
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              ></path>
            </svg>
          </a>
          <a href="#contact" class="btn btn-secondary">
            Let's Talk
          </a>
        </div>
      </div>
    </div>

    {/* Skills Section - COMMENTED OUT
    <div class="mb-20">
      <h3 class="text-2xl font-bold text-white text-center mb-8">
        {site.sections.about.skillsTitle} <span class="gradient-text">{site.sections.about.skillsTitleHighlight}</span>
      </h3>

      <div class="grid md:grid-cols-3 gap-6">
        {
          skills.map((category) => (
            <div class="card">
              <h4 class="text-lg font-semibold text-white mb-4">
                {category.name}
              </h4>
              <div class="space-y-3">
                {category.skills.slice(0, 5).map((skill) => (
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-gray-300">{skill.name}</span>
                      <span class="text-neon-pink">{skill.level}%</span>
                    </div>
                    <div class="h-2 bg-night-700/50 rounded-full overflow-hidden border border-neon-pink/20">
                      <div
                        class="h-full bg-gradient-to-r from-neon-pink via-neon-purple to-neon-orange rounded-full transition-all duration-1000"
                        style={`width: ${skill.level}%; box-shadow: 0 0 10px rgba(255, 0, 255, 0.4);`}
                        role="progressbar"
                        aria-valuenow={skill.level}
                        aria-valuemin="0"
                        aria-valuemax="100"
                        aria-label={`${skill.name}: ${skill.level}%`}
                      />
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))
        }
      </div>
    </div>
    */}

    <!-- Services Section -->
    <div>
      <h3 class="text-2xl font-bold text-white text-center mb-8">
        {site.sections.about.servicesTitle} <span class="gradient-text">{site.sections.about.servicesTitleHighlight}</span>
      </h3>

      <div class="grid md:grid-cols-3 gap-6">
        {
          services.map((service, index) => (
            <div class="card card-highlighted group">
              <div class="service-icon w-12 h-12 rounded-xl bg-gradient-to-br from-neon-pink/20 to-neon-purple/20 flex items-center justify-center mb-4 group-hover:from-neon-pink/30 group-hover:to-neon-purple/30 transition-colors border border-neon-pink/20">
                {service.icon === 'code' && (
                  <svg
                    class="w-6 h-6 text-neon-pink"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                    />
                  </svg>
                )}
                {service.icon === 'cloud' && (
                  <svg
                    class="w-6 h-6 text-neon-yellow"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
                    />
                  </svg>
                )}
                {service.icon === 'puzzle' && (
                  <svg
                    class="w-6 h-6 text-neon-orange"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"
                    />
                  </svg>
                )}
              </div>
              <h4 class="service-title text-lg font-semibold text-white mb-2">
                {service.title}
              </h4>
              <p class="text-gray-400 text-sm mb-4" set:html={service.description}></p>
              <ul class="space-y-2">
                {service.features.map((feature, index) => (
                  <li class="feature-item flex items-center gap-2 text-sm text-gray-300" style={`--feature-index: ${index}`}>
                    <svg
                      class="w-4 h-4 text-neon-green shrink-0"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M5 13l4 4L19 7"
                      />
                    </svg>
                    {feature}
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  function initServiceIconFlips() {
    const icons = document.querySelectorAll('.service-icon') as NodeListOf<HTMLElement>;
    if (icons.length === 0) return;

    // Handle hover on parent card - flip and stay flipped
    icons.forEach((icon) => {
      const parentCard = icon.closest('.card');

      if (parentCard) {
        parentCard.addEventListener('mouseenter', () => {
          icon.classList.add('flipped');
        });

        parentCard.addEventListener('mouseleave', () => {
          icon.classList.remove('flipped');
        });
      }
    });
  }

  // Tagline typewriter animation - only runs once
  let taglineAnimated = false;

  function initTaglineTypewriter() {
    if (taglineAnimated) return;

    const taglineEl = document.getElementById('about-tagline');
    if (!taglineEl) return;

    const textSpan = taglineEl.querySelector('.tagline-text') as HTMLElement;
    const cursorSpan = taglineEl.querySelector('.tagline-cursor') as HTMLElement;
    const fullText = taglineEl.getAttribute('data-text') || '';

    if (!textSpan || !fullText) return;

    const aboutSection = document.getElementById('about');
    if (!aboutSection) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !taglineAnimated) {
            taglineAnimated = true;
            observer.disconnect();

            // Start typewriter and bio animation together
            setTimeout(() => {
              if (cursorSpan) cursorSpan.style.display = 'inline-block';
              let charIndex = 0;
              const typeSpeed = 50;

              // Start bio line grow animation at same time as typewriter
              const bioLines = document.querySelectorAll('.bio-line') as NodeListOf<HTMLElement>;
              bioLines.forEach((line, i) => {
                setTimeout(() => {
                  line.classList.add('grow');
                  setTimeout(() => {
                    line.classList.remove('grow');
                  }, 300);
                }, i * 200);
              });

              function typeChar() {
                if (charIndex < fullText.length) {
                  textSpan.textContent = fullText.slice(0, charIndex + 1);
                  charIndex++;
                  setTimeout(typeChar, typeSpeed);
                } else {
                  // Wrap "Digital Excellence" in a span for animation
                  const html = textSpan.innerHTML;
                  textSpan.innerHTML = html.replace(
                    'Digital Excellence',
                    '<span class="excellence-pop" style="display: inline-block; transition: transform 0.5s ease-in-out;">Digital Excellence</span>'
                  );

                  // Animate "Excellence" while cursor is still blinking
                  setTimeout(() => {
                    const excellenceSpan = textSpan.querySelector('.excellence-pop') as HTMLElement;
                    if (excellenceSpan) {
                      excellenceSpan.style.transform = 'scale(1.02)';
                      setTimeout(() => {
                        excellenceSpan.style.transform = 'scale(1)';
                      }, 500);
                    }
                  }, 500);

                  // Let cursor blink 1 time then hide
                  setTimeout(() => {
                    if (cursorSpan) cursorSpan.style.display = 'none';
                  }, 1000);
                }
              }

              typeChar();
            }, 300);
          }
        });
      },
      { threshold: 0.5 }
    );

    observer.observe(aboutSection);
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initServiceIconFlips();
      initTaglineTypewriter();
    });
  } else {
    initServiceIconFlips();
    initTaglineTypewriter();
  }
  document.addEventListener('astro:after-swap', () => {
    initServiceIconFlips();
    taglineAnimated = false;
    initTaglineTypewriter();
  });
</script>
